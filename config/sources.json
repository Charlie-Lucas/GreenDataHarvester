{
  "version": "2.0.0",
  "sources": [
    {
      "id": "insee-sirene",
      "name": "INSEE Sirene",
      "description": "Base Sirene - Répertoire des entreprises et établissements",
      "connector": "insee",
      "type": "api",
      "config": {
        "baseUrl": "https://api.insee.fr/entreprises/sirene/V3",
        "endpoints": {
          "siret": "/siret",
          "siren": "/siren",
          "unitesLegales": "/unitesLegales"
        },
        "authentication": {
          "type": "bearer",
          "token": "${INSEE_API_TOKEN}"
        },
        "rateLimit": {
          "requestsPerMinute": 30,
          "requestsPerHour": 1000
        }
      },
      "persistence": {
        "strategy": "mongodb",
        "collection": "insee_sirene",
        "indexes": [
          {
            "fields": { "siret": 1 },
            "unique": true
          },
          {
            "fields": { "siren": 1 }
          },
          {
            "fields": { "dateCreationUniteLegale": 1 }
          }
        ],
        "ttl": {
          "enabled": true,
          "days": 30
        }
      },
      "schedule": {
        "enabled": true,
        "cron": "0 2 * * *",
        "timezone": "Europe/Paris"
      },
      "transform": {
        "enabled": true,
        "rules": [
          {
            "field": "dateCreationUniteLegale",
            "type": "date",
            "format": "YYYY-MM-DD"
          },
          {
            "field": "trancheEffectifsUniteLegale",
            "type": "enum",
            "mapping": {
              "00": "0 salarié",
              "01": "1 ou 2 salariés",
              "02": "3 à 5 salariés",
              "03": "6 à 9 salariés",
              "11": "10 à 19 salariés",
              "12": "20 à 49 salariés",
              "21": "50 à 99 salariés",
              "22": "100 à 199 salariés",
              "31": "200 à 249 salariés",
              "32": "250 à 499 salariés",
              "41": "500 à 999 salariés",
              "42": "1000 à 1999 salariés",
              "51": "2000 à 4999 salariés",
              "52": "5000 à 9999 salariés",
              "53": "10000+ salariés"
            }
          }
        ]
      }
    },
    {
      "id": "insee-bdm",
      "name": "INSEE BDM",
      "description": "Banque de Données Macroéconomiques",
      "connector": "insee",
      "type": "api",
      "config": {
        "baseUrl": "https://api.insee.fr/series/BDM/V1",
        "endpoints": {
          "data": "/data",
          "metadata": "/metadata"
        },
        "authentication": {
          "type": "bearer",
          "token": "${INSEE_API_TOKEN}"
        },
        "rateLimit": {
          "requestsPerMinute": 30,
          "requestsPerHour": 1000
        }
      },
      "persistence": {
        "strategy": "mongodb",
        "collection": "insee_bdm",
        "indexes": [
          {
            "fields": { "seriesId": 1, "date": 1 },
            "unique": true
          }
        ]
      },
      "schedule": {
        "enabled": true,
        "cron": "0 3 * * *",
        "timezone": "Europe/Paris"
      }
    },
    {
      "id": "insee-donnees-locales",
      "name": "INSEE Données Locales",
      "description": "Données localisées au niveau communal",
      "connector": "insee",
      "type": "api",
      "config": {
        "baseUrl": "https://api.insee.fr/donnees-locales/V0.1",
        "endpoints": {
          "geo": "/geo",
          "indicators": "/indicators"
        },
        "authentication": {
          "type": "bearer",
          "token": "${INSEE_API_TOKEN}"
        }
      },
      "persistence": {
        "strategy": "mongodb",
        "collection": "insee_donnees_locales",
        "indexes": [
          {
            "fields": { "geoCode": 1, "indicatorId": 1, "year": 1 },
            "unique": true
          }
        ]
      }
    }
  ],
  "global": {
    "retry": {
      "maxAttempts": 3,
      "delayMs": 1000,
      "backoffMultiplier": 2
    },
    "cache": {
      "enabled": true,
      "strategy": "redis",
      "ttl": 3600
    },
    "logging": {
      "level": "info",
      "format": "json"
    }
  }
}
